{% extends 'base.html' %}

{% block title %}{{ event.titulo }} - SGEA{% endblock %}

{% block content %}
<div class="container my-4">
  <div class="row">
    <!-- Coluna Principal -->
    <div class="col-lg-8">
      <div class="card mb-4">
        <!-- Banner do Evento -->
        {% if event.get_banner_url %}
        <img src="{{ event.get_banner_url }}" class="card-img-top" alt="Banner do evento {{ event.titulo }}" 
             style="max-height: 300px; object-fit: cover;">
        {% endif %}
        
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <span class="badge bg-primary fs-6">{{ event.get_tipo_evento_display }}</span>
            {% if event.is_passado %}
            <span class="badge bg-secondary">Encerrado</span>
            {% elif event.is_em_andamento %}
            <span class="badge bg-success">Em andamento</span>
            {% elif not event.ativo %}
            <span class="badge bg-warning text-dark">Inativo</span>
            {% else %}
            <span class="badge bg-info">Vagas: {{ event.vagas_disponiveis }}/{{ event.vagas }}</span>
            {% endif %}
          </div>
          
          <h1 class="card-title h2">{{ event.titulo }}</h1>
          
          <div class="row my-4">
            <div class="col-md-6 mb-3">
              <p class="mb-2">
                <i class="bi bi-calendar-event text-primary" aria-hidden="true"></i>
                <strong>Data:</strong><br>
                {{ event.data_inicio|date:"d/m/Y" }}
                {% if event.data_inicio != event.data_fim %}
                a {{ event.data_fim|date:"d/m/Y" }}
                {% endif %}
              </p>
            </div>
            <div class="col-md-6 mb-3">
              <p class="mb-2">
                <i class="bi bi-clock text-primary" aria-hidden="true"></i>
                <strong>Horário:</strong><br>
                {{ event.horario_inicio|time:"H:i" }} às {{ event.horario_fim|time:"H:i" }}
              </p>
            </div>
            <div class="col-md-6 mb-3">
              <p class="mb-2">
                <i class="bi bi-geo-alt text-primary" aria-hidden="true"></i>
                <strong>Local:</strong><br>
                {{ event.local }}
              </p>
            </div>
            <div class="col-md-6 mb-3">
              <p class="mb-2">
                <i class="bi bi-people text-primary" aria-hidden="true"></i>
                <strong>Vagas:</strong><br>
                {{ event.vagas_disponiveis }} disponíveis de {{ event.vagas }}
              </p>
            </div>
          </div>
          
          <hr>
          
          <h5><i class="bi bi-text-paragraph" aria-hidden="true"></i> Descrição</h5>
          <p class="card-text">{{ event.descricao|linebreaks }}</p>
        </div>
      </div>
    </div>
    
    <!-- Sidebar -->
    <div class="col-lg-4">
      <!-- Card de Ações -->
      <div class="card mb-4">
        <div class="card-header">
          <i class="bi bi-lightning" aria-hidden="true"></i> Ações
        </div>
        <div class="card-body">
          {% if user.is_authenticated %}
            {% if is_organizador %}
              <div class="d-grid gap-2">
                <a href="{% url 'events:event_update' event.pk %}" class="btn btn-primary">
                  <i class="bi bi-pencil" aria-hidden="true"></i> Editar Evento
                </a>
                <a href="{% url 'events:event_inscriptions' event.pk %}" class="btn btn-info">
                  <i class="bi bi-people" aria-hidden="true"></i> Ver Inscritos ({{ event.get_inscritos_count }})
                </a>
                {% if event.is_passado or event.is_em_andamento %}
                <a href="{% url 'events:confirm_presence' event.pk %}" class="btn btn-success">
                  <i class="bi bi-check2-square" aria-hidden="true"></i> Confirmar Presenças
                </a>
                {% endif %}
                <a href="{% url 'events:event_delete' event.pk %}" class="btn btn-outline-danger">
                  <i class="bi bi-trash" aria-hidden="true"></i> Excluir
                </a>
              </div>
            {% elif is_inscrito %}
              <div class="alert alert-success mb-3">
                <i class="bi bi-check-circle" aria-hidden="true"></i>
                Você está inscrito neste evento!
              </div>
              {% if inscricao.presenca_confirmada %}
              <div class="alert alert-info mb-3">
                <i class="bi bi-award" aria-hidden="true"></i>
                Presença confirmada! Seu certificado será disponibilizado após o término do evento.
              </div>
              {% endif %}
              <a href="{% url 'events:inscription_cancel' inscricao.pk %}" class="btn btn-outline-danger w-100">
                <i class="bi bi-x-circle" aria-hidden="true"></i> Cancelar Inscrição
              </a>
            {% elif can_inscribe %}
              <a href="{% url 'events:inscription_create' event.pk %}" class="btn btn-primary btn-lg w-100">
                <i class="bi bi-check-lg" aria-hidden="true"></i> Inscrever-se
              </a>
            {% elif user.is_organizador %}
              <div class="alert alert-info">
                <i class="bi bi-info-circle" aria-hidden="true"></i>
                Organizadores não podem se inscrever em eventos.
              </div>
            {% elif not user.email_confirmed %}
              <div class="alert alert-warning">
                <i class="bi bi-exclamation-triangle" aria-hidden="true"></i>
                Confirme seu email para se inscrever.
              </div>
            {% elif not event.tem_vagas %}
              <div class="alert alert-danger">
                <i class="bi bi-x-circle" aria-hidden="true"></i>
                Não há mais vagas disponíveis.
              </div>
            {% elif event.is_passado %}
              <div class="alert alert-secondary">
                <i class="bi bi-calendar-x" aria-hidden="true"></i>
                Este evento já foi encerrado.
              </div>
            {% endif %}
          {% else %}
            <div class="alert alert-info">
              <i class="bi bi-info-circle" aria-hidden="true"></i> Faça login para se inscrever
            </div>
            <a href="{% url 'users:login' %}?next={{ request.path }}" class="btn btn-primary w-100">
              <i class="bi bi-box-arrow-in-right" aria-hidden="true"></i> Fazer Login
            </a>
          {% endif %}
        </div>
      </div>
      
      <!-- Card do Organizador -->
      <div class="card mb-4">
        <div class="card-header">
          <i class="bi bi-person-badge" aria-hidden="true"></i> Organização
        </div>
        <div class="card-body">
          <p class="mb-2">
            <strong>Organizador:</strong><br>
            {{ event.organizador.get_full_name }}
          </p>
          <p class="mb-0">
            <strong>Professor Responsável:</strong><br>
            {{ event.professor_responsavel.get_full_name }}
            <br>
            <small class="text-muted">{{ event.professor_responsavel.instituicao_ensino }}</small>
          </p>
        </div>
      </div>
      
      <!-- Card de Informações -->
      <div class="card">
        <div class="card-header">
          <i class="bi bi-info-circle" aria-hidden="true"></i> Informações
        </div>
        <div class="card-body">
          <p class="mb-2">
            <small class="text-muted">
              <i class="bi bi-calendar-plus" aria-hidden="true"></i>
              Criado em: {{ event.data_criacao|date:"d/m/Y" }}
            </small>
          </p>
          <p class="mb-0">
            <small class="text-muted">
              <i class="bi bi-arrow-clockwise" aria-hidden="true"></i>
              Atualizado em: {{ event.data_atualizacao|date:"d/m/Y H:i" }}
            </small>
          </p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Botão Voltar -->
  <div class="mt-3">
    <a href="{% url 'events:home' %}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left" aria-hidden="true"></i> Voltar para Eventos
    </a>
  </div>
</div>
{% endblock %}
