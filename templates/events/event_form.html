{% extends 'base.html' %}

{% block title %}{{ action }} Evento - SGEA{% endblock %}

{% block content %}
<div class="container my-4">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="bi bi-calendar-plus" aria-hidden="true"></i> {{ action }} Evento
          </h5>
        </div>
        <div class="card-body">
          <form method="POST" enctype="multipart/form-data" novalidate>
            {% csrf_token %}
            
            <!-- Título -->
            <div class="mb-3">
              <label for="{{ form.titulo.id_for_label }}" class="form-label">
                {{ form.titulo.label }} <span class="text-danger" aria-hidden="true">*</span>
              </label>
              {{ form.titulo }}
              {% if form.titulo.errors %}
              <div class="text-danger small" role="alert">{{ form.titulo.errors }}</div>
              {% endif %}
            </div>
            
            <!-- Descrição -->
            <div class="mb-3">
              <label for="{{ form.descricao.id_for_label }}" class="form-label">
                {{ form.descricao.label }} <span class="text-danger" aria-hidden="true">*</span>
              </label>
              {{ form.descricao }}
              {% if form.descricao.errors %}
              <div class="text-danger small" role="alert">{{ form.descricao.errors }}</div>
              {% endif %}
            </div>
            
            <!-- Tipo de Evento e Professor Responsável -->
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="{{ form.tipo_evento.id_for_label }}" class="form-label">
                  {{ form.tipo_evento.label }} <span class="text-danger" aria-hidden="true">*</span>
                </label>
                {{ form.tipo_evento }}
                {% if form.tipo_evento.errors %}
                <div class="text-danger small" role="alert">{{ form.tipo_evento.errors }}</div>
                {% endif %}
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.professor_responsavel.id_for_label }}" class="form-label">
                  {{ form.professor_responsavel.label }} <span class="text-danger" aria-hidden="true">*</span>
                </label>
                {{ form.professor_responsavel }}
                {% if form.professor_responsavel.errors %}
                <div class="text-danger small" role="alert">{{ form.professor_responsavel.errors }}</div>
                {% endif %}
                {% if form.professor_responsavel.help_text %}
                <small class="text-muted">{{ form.professor_responsavel.help_text }}</small>
                {% endif %}
              </div>
            </div>
            
            <!-- Datas -->
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="{{ form.data_inicio.id_for_label }}" class="form-label">
                  {{ form.data_inicio.label }} <span class="text-danger" aria-hidden="true">*</span>
                </label>
                {{ form.data_inicio }}
                {% if form.data_inicio.errors %}
                <div class="text-danger small" role="alert">{{ form.data_inicio.errors }}</div>
                {% endif %}
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.data_fim.id_for_label }}" class="form-label">
                  {{ form.data_fim.label }} <span class="text-danger" aria-hidden="true">*</span>
                </label>
                {{ form.data_fim }}
                {% if form.data_fim.errors %}
                <div class="text-danger small" role="alert">{{ form.data_fim.errors }}</div>
                {% endif %}
              </div>
            </div>
            
            <!-- Horários -->
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="{{ form.horario_inicio.id_for_label }}" class="form-label">
                  {{ form.horario_inicio.label }} <span class="text-danger" aria-hidden="true">*</span>
                </label>
                {{ form.horario_inicio }}
                {% if form.horario_inicio.errors %}
                <div class="text-danger small" role="alert">{{ form.horario_inicio.errors }}</div>
                {% endif %}
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.horario_fim.id_for_label }}" class="form-label">
                  {{ form.horario_fim.label }} <span class="text-danger" aria-hidden="true">*</span>
                </label>
                {{ form.horario_fim }}
                {% if form.horario_fim.errors %}
                <div class="text-danger small" role="alert">{{ form.horario_fim.errors }}</div>
                {% endif %}
              </div>
            </div>
            
            <!-- Local e Vagas -->
            <div class="row">
              <div class="col-md-8 mb-3">
                <label for="{{ form.local.id_for_label }}" class="form-label">
                  {{ form.local.label }} <span class="text-danger" aria-hidden="true">*</span>
                </label>
                {{ form.local }}
                {% if form.local.errors %}
                <div class="text-danger small" role="alert">{{ form.local.errors }}</div>
                {% endif %}
              </div>
              <div class="col-md-4 mb-3">
                <label for="{{ form.vagas.id_for_label }}" class="form-label">
                  {{ form.vagas.label }} <span class="text-danger" aria-hidden="true">*</span>
                </label>
                {{ form.vagas }}
                {% if form.vagas.errors %}
                <div class="text-danger small" role="alert">{{ form.vagas.errors }}</div>
                {% endif %}
              </div>
            </div>
            
            <!-- Banner -->
            <div class="mb-3">
              <label for="{{ form.banner.id_for_label }}" class="form-label">
                {{ form.banner.label }}
              </label>
              {{ form.banner }}
              {% if form.banner.errors %}
              <div class="text-danger small" role="alert">{{ form.banner.errors }}</div>
              {% endif %}
              <small class="text-muted">{{ form.banner.help_text }}</small>
              
              {% if event.banner %}
              <div class="mt-2">
                <small class="text-muted">Banner atual:</small>
                <img src="{{ event.banner.url }}" alt="Banner atual" class="img-thumbnail mt-1" style="max-height: 100px;">
              </div>
              {% endif %}
            </div>
            
            <!-- Ativo -->
            <div class="mb-4">
              <div class="form-check">
                {{ form.ativo }}
                <label class="form-check-label" for="{{ form.ativo.id_for_label }}">
                  {{ form.ativo.label }}
                </label>
              </div>
              <small class="text-muted">Desmarque para impedir novas inscrições.</small>
            </div>
            
            {% if form.non_field_errors %}
            <div class="alert alert-danger" role="alert">
              {{ form.non_field_errors }}
            </div>
            {% endif %}
            
            <div class="d-flex justify-content-between">
              <a href="{% if event %}{% url 'events:event_detail' event.pk %}{% else %}{% url 'events:home' %}{% endif %}" 
                 class="btn btn-secondary">
                <i class="bi bi-arrow-left" aria-hidden="true"></i> Cancelar
              </a>
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-check-lg" aria-hidden="true"></i> {{ action }} Evento
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
  // Preview do banner
  $('#id_banner').on('change', function() {
    var file = this.files[0];
    if (file) {
      var reader = new FileReader();
      reader.onload = function(e) {
        var preview = $('#banner-preview');
        if (preview.length === 0) {
          $('#id_banner').after('<div id="banner-preview" class="mt-2"><small class="text-muted">Preview:</small><br><img src="" alt="Preview" class="img-thumbnail mt-1" style="max-height: 150px;"></div>');
          preview = $('#banner-preview');
        }
        preview.find('img').attr('src', e.target.result);
      };
      reader.readAsDataURL(file);
    }
  });
  
  // Validação de data fim >= data início
  $('#id_data_fim').on('change', function() {
    var dataInicio = $('#id_data_inicio').val();
    var dataFim = $(this).val();
    
    if (dataInicio && dataFim && dataFim < dataInicio) {
      alert('A data de término não pode ser anterior à data de início.');
      $(this).val(dataInicio);
    }
  });
});
</script>
{% endblock %}
